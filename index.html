<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculate your Nepal income tax for FY 2082-83 with this interactive tax calculator. Supports monthly or yearly salary input, tax slab breakdown, and tax-saving tips.">
    <meta name="keywords" content="Nepal tax calculator, FY 2082-83, income tax Nepal, tax slabs, tax saving tips, social security fund">
    <meta name="author" content="Arjun Adhikari">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Nepal Tax Calculator FY 2082-83">
    <meta property="og:description" content="Calculate your Nepal income tax for fiscal year 2082-83 with this interactive calculator. Get instant tax breakdown, saving tips, and personalized recommendations.">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Nepal Tax Calculator FY 2082-83">
    <meta property="twitter:description" content="Calculate your Nepal income tax for fiscal year 2082-83 with this interactive calculator. Get instant tax breakdown, saving tips, and personalized recommendations.">
    
    <!-- Structured Data / JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Nepal Tax Calculator",
      "description": "Calculate your Nepal income tax for fiscal year 2082-83 with this interactive calculator. Get instant tax breakdown, saving tips, and personalized recommendations.",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "NPR"
      },
      "author": {
        "@type": "Person",
        "name": "Arjun Adhikari",
        "url": "https://github.com/thearjun"
      }
    }
    </script>
    
    <!-- Canonical URL -->
    
    <title>Nepal Tax Calculator FY 2082-83</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <meta name="theme-color" content="#4f46e5">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 50%, #e2e8f0 100%);
            color: #1e293b;
            min-height: 100vh;
        }
        .container {
            min-height: 100vh;
            padding-bottom: 3rem;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.7) inset;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
        }
        .card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 32px 64px -12px rgba(99, 102, 241, 0.15), 0 0 0 1px rgba(99, 102, 241, 0.2) inset;
            border-color: rgba(99, 102, 241, 0.3);
        }
        .input-field {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(226, 232, 240, 0.8);
            background: rgba(248, 250, 252, 0.8);
            color: #1e293b;
        }
        .input-field:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2), 0 0 20px rgba(99, 102, 241, 0.1);
            background: rgba(255, 255, 255, 0.95);
        }
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.4);
            position: relative;
            overflow: hidden;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #c026d3 100%);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4), 0 0 20px rgba(139, 92, 246, 0.3);
        }
        .tax-item {
            transition: all 0.2s;
        }
        .tax-item:hover {
            transform: scale(1.02);
            background: rgba(99, 102, 241, 0.05);
            border-color: rgba(99, 102, 241, 0.2);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }
        .badge {
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        /* Accessibility Improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }
        .switch-field {
            display: flex;
            width: 100%;
            overflow: hidden;
            border-radius: 0.75rem;
            background-color: #f1f5f9;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .switch-field input {
            position: absolute !important;
            clip: rect(0, 0, 0, 0);
            height: 1px;
            width: 1px;
            border: 0;
            overflow: hidden;
        }
        .switch-field label {
            flex: 1;
            background-color: #f1f5f9;
            color: #475569;
            padding: 0.75rem 1.25rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            text-align: center;
        }
        .switch-field input:checked + label {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            transform: translateY(-2px);
        }
        .switch-field label:hover {
            background-color: #e2e8f0;
            transform: translateY(-1px);
        }
        .switch-field input:checked + label:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-12">
            <div class="relative">
                <h1 class="text-5xl md:text-7xl font-black bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">Nepal Tax Calculator</h1>
                <div class="absolute inset-0 -z-10">
                    <div class="h-1 w-1/3 mx-auto bg-gradient-to-r from-indigo-500 to-purple-500 blur-3xl opacity-30"></div>
                </div>
            </div>
            <p class="text-2xl text-indigo-600 font-semibold">Fiscal Year 2082-83</p>
            <!-- Adding SEO rich text content -->
            <div class="mt-6 text-base text-slate-600 max-w-3xl mx-auto leading-relaxed">
                <p>Use our <strong class="text-indigo-600">Nepal Income Tax Calculator for FY 2082-83</strong> to accurately calculate your tax liability based on the latest tax slabs set by the Nepal Inland Revenue Department. This comprehensive calculator accounts for both individual and couple filing statuses, and includes Social Security Fund (SSF) contributions.</p>
            </div>
        </header>

        <!-- Input Section -->
        <div class="card p-6 md:p-8 mb-8">
            <h2 class="text-3xl font-bold text-slate-800 mb-8 flex items-center">
                <i class="fas fa-calculator mr-4 text-indigo-500 text-2xl"></i>Income Details
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Salary Input -->
                <div>
                    <label for="salary" class="block text-slate-700 font-semibold mb-3">Salary (NPR)</label>
                    <input type="number" id="salary" aria-describedby="salary-description" 
                           class="w-full p-3 rounded-lg input-field focus:outline-none bg-indigo-50" 
                           placeholder="Enter amount">
                    <p id="salary-description" class="text-sm text-slate-500 mt-2">Gross salary before deductions</p>
                </div>
                
                <!-- Monthly/Yearly Switch -->
                <div>
                    <label class="block text-slate-700 font-semibold mb-3">Income Period</label>
                    <div class="switch-field">
                        <input type="radio" id="monthly" name="income-period" value="monthly" checked />
                        <label for="monthly">Monthly</label>
                        <input type="radio" id="yearly" name="income-period" value="yearly" />
                        <label for="yearly">Yearly</label>
                    </div>
                </div>
                
                <!-- Marital Status -->
                <div>
                    <label for="maritalStatus" class="block text-slate-700 font-semibold mb-3">Filing Status</label>
                    <select id="maritalStatus" class="w-full p-3 rounded-lg input-field focus:outline-none bg-indigo-50">
                        <option value="individual">Individual</option>
                        <option value="couple">Couple (Joint)</option>
                    </select>
                </div>
                
                <!-- SSF Contribution -->
                <div>
                    <label for="ssf" class="block text-slate-700 font-semibold mb-3">SSF Participation</label>
                    <div class="w-full p-3 rounded-lg border border-slate-200 bg-slate-50 flex items-center">
                        <input type="checkbox" id="ssf" class="sr-only">
                        <label for="ssf" class="flex items-center cursor-pointer w-full">
                            <span class="relative w-12 h-7 transition bg-gray-300 rounded-full mr-3">
                                <span class="absolute inset-y-0 left-0 w-7 h-7 bg-white rounded-full shadow transition-transform transform scale-90 duration-150"></span>
                            </span>
                            <span>SSF Contribution</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <button id="calculate" class="mt-8 w-full p-4 rounded-lg font-semibold text-white btn-primary flex items-center justify-center">
                <i class="fas fa-calculator mr-2"></i>Calculate Your Tax
            </button>
        </div>

        <!-- Results Section -->
        <div id="results" class="card hidden">
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-0">
                <!-- Tax Summary -->
                <div class="p-6 md:p-8 col-span-2">
                    <h2 class="text-3xl font-bold text-slate-800 mb-8 flex items-center">
                        <i class="fas fa-receipt mr-4 text-indigo-500 text-2xl"></i>Tax Summary
                    </h2>
                    <ul class="space-y-4">
                        <li class="tax-item flex justify-between p-5 rounded-xl bg-white/70 border border-slate-200 shadow-sm">
                            <span class="text-slate-600">Total Annual Income</span>
                            <span id="totalIncome" class="font-bold text-slate-800 text-lg"></span>
                        </li>
                        <li class="tax-item flex justify-between p-5 rounded-xl bg-white/70 border border-slate-200 shadow-sm">
                            <span class="text-slate-600">Social Security Tax <span class="badge bg-blue-100 text-blue-700 border border-blue-200">1%</span></span>
                            <span id="ssfTax" class="font-bold text-slate-800 text-lg"></span>
                        </li>
                        <li class="tax-item flex justify-between p-5 rounded-xl bg-white/70 border border-slate-200 shadow-sm">
                            <span class="text-slate-600">Income Tax</span>
                            <span id="incomeTax" class="font-bold text-slate-800 text-lg"></span>
                        </li>
                        <li class="tax-item flex justify-between p-5 rounded-xl bg-red-50/80 border border-red-200 shadow-sm">
                            <span class="text-red-700 font-semibold">Total Tax Payable</span>
                            <span id="totalTax" class="font-bold text-red-600 text-xl"></span>
                        </li>
                        <li class="tax-item flex justify-between p-5 rounded-xl bg-emerald-50/80 border border-emerald-200 shadow-sm">
                            <span class="text-emerald-700 font-semibold">Net Annual Income</span>
                            <span id="netIncome" class="font-bold text-emerald-600 text-xl"></span>
                        </li>
                        <li class="tax-item flex justify-between p-5 rounded-xl bg-emerald-50/80 border border-emerald-200 shadow-sm">
                            <span class="text-emerald-700 font-semibold">Net Monthly Income</span>
                            <span id="monthlyNetIncome" class="font-bold text-emerald-600 text-xl"></span>
                        </li>
                    </ul>
                </div>
                
                <!-- Charts -->
                <div class="p-6 md:p-8 col-span-3 bg-white/50 border-l border-slate-200">
                    <h2 class="text-3xl font-bold text-slate-800 mb-8 flex items-center">
                        <i class="fas fa-chart-pie mr-4 text-indigo-500 text-2xl"></i>Tax Visualization
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-semibold text-slate-700 mb-4">Tax by Slab</h3>
                            <div class="aspect-square">
                                <canvas id="taxChart" aria-label="Tax breakdown by slab" role="img"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-slate-700 mb-4">Income Distribution</h3>
                            <div class="aspect-square">
                                <canvas id="incomeChart" aria-label="Income distribution" role="img"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-xl font-semibold text-slate-700 mb-4">Tax Burden</h3>
                        <div class="w-full h-4 bg-slate-200 rounded-full overflow-hidden border border-slate-300">
                            <div id="taxBurdenBar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 text-xs font-bold text-white text-center leading-4 rounded-full transition-all duration-1000" style="width: 0%">
                                0%
                            </div>
                        </div>
                        <p id="taxBurdenText" class="text-sm text-slate-600 mt-3">Your effective tax rate</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Insights Section -->
        <div id="insights" class="card p-6 md:p-8 mt-8 hidden">
            <h2 class="text-3xl font-bold text-slate-800 mb-8 flex items-center">
                <i class="fas fa-lightbulb mr-4 text-amber-500 text-2xl"></i>Tax Insights
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-xl font-semibold text-slate-700 mb-6">Tax Saving Opportunities</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 mr-3"></i>
                            <div>
                                <strong class="text-indigo-600">SSF Contribution:</strong>
                                <span class="text-slate-600"> Waive the 1% Social Security Tax by joining the Social Security Fund.</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 mr-3"></i>
                            <div>
                                <strong class="text-indigo-600">Life Insurance:</strong>
                                <span class="text-slate-600"> Deduct up to NPR 25,000 by paying life insurance premiums.</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 mr-3"></i>
                            <div>
                                <strong class="text-indigo-600">Health Insurance:</strong>
                                <span class="text-slate-600"> Deduct up to NPR 20,000 with health insurance premiums.</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 mr-3"></i>
                            <div>
                                <strong class="text-indigo-600">Pension Income:</strong>
                                <span class="text-slate-600"> Get an additional 25% deduction on the first slab for pension income.</span>
                            </div>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-slate-700 mb-6">Tax Planning Strategies</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 mr-3"></i>
                            <div>
                                <strong class="text-indigo-600">Remote Work Allowance:</strong>
                                <span class="text-slate-600"> Claim up to NPR 50,000 deduction if working in remote areas.</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 mr-3"></i>
                            <div>
                                <strong class="text-indigo-600">Joint Filing:</strong>
                                <span class="text-slate-600"> File as a couple to leverage higher initial tax slabs (NPR 600,000 vs. 500,000).</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 mr-3"></i>
                            <div>
                                <strong class="text-indigo-600">Retirement Contributions:</strong>
                                <span class="text-slate-600"> Contribute to approved retirement schemes for tax benefits.</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 mr-3"></i>
                            <div>
                                <strong class="text-indigo-600">Income Splitting:</strong>
                                <span class="text-slate-600"> Consider splitting income between family members if legally possible.</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl mt-8 border border-indigo-200" id="personalized-insight">
                <h3 class="text-xl font-semibold text-indigo-700 mb-4 flex items-center">
                    <i class="fas fa-user-check mr-3 text-indigo-500"></i>Personalized Recommendation
                </h3>
                <p id="recommendation" class="text-slate-700 leading-relaxed">Calculate your tax to see personalized recommendations.</p>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-16 text-center text-slate-500 text-sm">
            <p class="font-medium">Data based on Nepal Tax Rates for FY 2082-83</p>
            <p class="mt-2 text-slate-600">This calculator is for informational purposes only. Always consult with a tax professional.</p>
            
            <!-- SEO Footer Links -->
            <div class="mt-8 pt-6 border-t border-slate-300">
                 <p class="mt-6 text-xs text-slate-500">Â© 2025 Nepal Tax Calculator. Developed by <a href="https://github.com/thearjun" class="text-indigo-600 hover:text-indigo-700 transition-colors">Arjun Adhikari</a></p>
            </div>
        </footer>
    </div>

    <!-- Chart.js and JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize charts
        let taxPieChart = null;
        let incomeChart = null;
        
        // Toggle switch for monthly/yearly input
        document.getElementById('monthly').addEventListener('change', function() {
            document.getElementById('salary').placeholder = "Enter monthly salary";
        });
        
        document.getElementById('yearly').addEventListener('change', function() {
            document.getElementById('salary').placeholder = "Enter yearly salary";
        });
        
        // Toggle styling for SSF switch
        document.getElementById('ssf').addEventListener('change', function() {
            const ssfLabel = this.nextElementSibling;
            const ssfSwitch = ssfLabel.querySelector('span:first-child');
            const ssfIndicator = ssfSwitch.querySelector('span');
            
            if (this.checked) {
                ssfSwitch.classList.remove('bg-gray-300');
                ssfSwitch.classList.add('bg-indigo-600');
                ssfIndicator.classList.add('translate-x-5');
            } else {
                ssfSwitch.classList.remove('bg-indigo-600');
                ssfSwitch.classList.add('bg-gray-300');
                ssfIndicator.classList.remove('translate-x-5');
            }
        });

        document.getElementById('calculate').addEventListener('click', function() {
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const isMonthly = document.getElementById('monthly').checked;
            const income = isMonthly ? salary * 12 : salary;
            const maritalStatus = document.getElementById('maritalStatus').value;
            const ssf = document.getElementById('ssf').checked;

            if (salary <= 0) {
                alert("Please enter a valid salary amount.");
                return;
            }

            // Tax calculation
            let slabs = maritalStatus === 'individual' ?
                { base: 500000, next1: 200000, next2: 300000, next3: 1000000, next4: 2000000 } :
                { base: 600000, next1: 200000, next2: 300000, next3: 900000, next4: 2000000 };

            let ssfTax = ssf ? 0 : Math.min(slabs.base, income) * 0.01;
            let remaining = income;
            let tax = 0;
            const taxBySlabs = [];
            
            // First Slab (0%)
            const firstSlabAmount = Math.min(slabs.base, remaining);
            remaining -= firstSlabAmount;
            taxBySlabs.push({
                name: '0% Slab',
                amount: firstSlabAmount,
                tax: 0,
                rate: '0%'
            });
            
            // Second Slab (10%)
            if (remaining > 0) {
                const secondSlabAmount = Math.min(slabs.next1, remaining);
                const secondSlabTax = secondSlabAmount * 0.1;
                tax += secondSlabTax;
                remaining -= secondSlabAmount;
                taxBySlabs.push({
                    name: '10% Slab',
                    amount: secondSlabAmount,
                    tax: secondSlabTax,
                    rate: '10%'
                });
            }
            
            // Third Slab (20%)
            if (remaining > 0) {
                const thirdSlabAmount = Math.min(slabs.next2, remaining);
                const thirdSlabTax = thirdSlabAmount * 0.2;
                tax += thirdSlabTax;
                remaining -= thirdSlabAmount;
                taxBySlabs.push({
                    name: '20% Slab',
                    amount: thirdSlabAmount,
                    tax: thirdSlabTax,
                    rate: '20%'
                });
            }
            
            // Fourth Slab (30%)
            if (remaining > 0) {
                const fourthSlabAmount = Math.min(slabs.next3, remaining);
                const fourthSlabTax = fourthSlabAmount * 0.3;
                tax += fourthSlabTax;
                remaining -= fourthSlabAmount;
                taxBySlabs.push({
                    name: '30% Slab',
                    amount: fourthSlabAmount,
                    tax: fourthSlabTax,
                    rate: '30%'
                });
            }
            
            // Fifth Slab (36%)
            if (remaining > 0) {
                const fifthSlabAmount = Math.min(slabs.next4, remaining);
                const fifthSlabTax = fifthSlabAmount * 0.36;
                tax += fifthSlabTax;
                remaining -= fifthSlabAmount;
                taxBySlabs.push({
                    name: '36% Slab',
                    amount: fifthSlabAmount,
                    tax: fifthSlabTax,
                    rate: '36%'
                });
            }
            
            // Sixth Slab (39%)
            if (remaining > 0) {
                const sixthSlabTax = remaining * 0.39;
                tax += sixthSlabTax;
                taxBySlabs.push({
                    name: '39% Slab',
                    amount: remaining,
                    tax: sixthSlabTax,
                    rate: '39%'
                });
            }

            let totalTax = tax + ssfTax;
            let netIncome = income - totalTax;
            let monthlyNetIncome = netIncome / 12;
            
            // Calculate effective tax rate
            const effectiveTaxRate = (totalTax / income) * 100;

            // Update UI
            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('ssfTax').textContent = formatCurrency(ssfTax);
            document.getElementById('incomeTax').textContent = formatCurrency(tax);
            document.getElementById('totalTax').textContent = formatCurrency(totalTax);
            document.getElementById('netIncome').textContent = formatCurrency(netIncome);
            document.getElementById('monthlyNetIncome').textContent = formatCurrency(monthlyNetIncome);
            
            // Update tax burden bar
            const taxBurdenBar = document.getElementById('taxBurdenBar');
            taxBurdenBar.style.width = `${effectiveTaxRate}%`;
            taxBurdenBar.textContent = `${effectiveTaxRate.toFixed(2)}%`;
            document.getElementById('taxBurdenText').textContent = 
                `Your effective tax rate is ${effectiveTaxRate.toFixed(2)}% of your total income`;
                
            // Show results
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('insights').classList.remove('hidden');
            
            // Generate personalized recommendations
            generateRecommendations(income, totalTax, effectiveTaxRate, maritalStatus, ssf);

            // Update Charts
            updateCharts(taxBySlabs, totalTax, netIncome, ssfTax);
        });
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ne-NP', {
                style: 'currency',
                currency: 'NPR',
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        function updateCharts(taxBySlabs, totalTax, netIncome, ssfTax) {
            const ctx1 = document.getElementById('taxChart').getContext('2d');
            const ctx2 = document.getElementById('incomeChart').getContext('2d');
            
            // Destroy existing charts if they exist
            if (taxPieChart) taxPieChart.destroy();
            if (incomeChart) incomeChart.destroy();
            
            // Tax breakdown chart
            const taxLabels = taxBySlabs.map(slab => `${slab.name}: ${formatCurrency(slab.tax)}`);
            const taxData = taxBySlabs.map(slab => slab.tax);
            if (ssfTax > 0) {
                taxLabels.push(`SSF Tax: ${formatCurrency(ssfTax)}`);
                taxData.push(ssfTax);
            }
            
            taxPieChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: taxLabels,
                    datasets: [{
                        data: taxData,
                        backgroundColor: [
                            '#4338ca', '#6366f1', '#8b5cf6', '#a855f7', '#d946ef', '#ec4899', '#f43f5e'
                        ],
                        borderWidth: 1,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 10
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = (value / totalTax * 100).toFixed(1);
                                    return `${label} (${percentage}% of total tax)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Income distribution chart
            incomeChart = new Chart(ctx2, {
                type: 'pie',
                data: {
                    labels: ['Net Income', 'Total Tax'],
                    datasets: [{
                        data: [netIncome, totalTax],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderWidth: 1,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const totalAmount = netIncome + totalTax;
                                    const percentage = (value / totalAmount * 100).toFixed(1);
                                    return `${label}: ${formatCurrency(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function generateRecommendations(income, totalTax, taxRate, maritalStatus, ssf) {
            let recommendation = "";
            
            if (income < 600000) {
                recommendation = "Your income is in the lowest tax bracket. Focus on increasing your earning potential rather than tax planning at this stage.";
            } else if (income < 1000000) {
                if (!ssf) {
                    recommendation = "Consider enrolling in the Social Security Fund (SSF) to save on the 1% social security tax. Additionally, explore life and health insurance premiums for tax deductions.";
                } else {
                    recommendation = "Your SSF participation is already saving you money. Consider life and health insurance premium deductions for additional tax benefits.";
                }
            } else if (income < 2000000) {
                if (maritalStatus === 'individual' && income > 1000000) {
                    recommendation = "Consider filing taxes as a couple if possible, as this could save you significant tax by utilizing the higher initial tax slab (NPR 600,000 vs. 500,000).";
                } else {
                    recommendation = "You're in a higher tax bracket. Maximize all available deductions including life insurance, health insurance, and retirement contributions.";
                }
            } else {
                recommendation = "At your income level, consider comprehensive tax planning with a professional. Explore investment options in tax-advantaged sectors and retirement planning strategies.";
            }
            
            document.getElementById('recommendation').textContent = recommendation;
        }
    </script>

    <!-- Structured Data / JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "What are the income tax slabs in Nepal for FY 2082-83?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "For individuals, the first NPR 500,000 is taxed at 1% (for Social Security Tax only). The next NPR 200,000 is taxed at 10%, the next NPR 300,000 at 20%, the next NPR 1,000,000 at 30%, the next NPR 2,000,000 at 36%, and any amount above that at 39%. For couples filing jointly, the first slab extends to NPR 600,000."
        }
      }, {
        "@type": "Question",
        "name": "How can I reduce my tax liability in Nepal?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "You can reduce your tax liability by: 1) Contributing to the Social Security Fund (SSF) to waive the 1% Social Security Tax, 2) Deducting life insurance premiums (up to NPR 25,000), 3) Deducting health insurance premiums (up to NPR 20,000), 4) Filing taxes jointly as a couple if married, 5) Contributing to approved retirement schemes, and 6) Claiming remote work allowance if applicable."
        }
      }, {
        "@type": "Question",
        "name": "What is Social Security Fund (SSF) in Nepal?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The Social Security Fund (SSF) is a government-run social security scheme in Nepal. By contributing to SSF, employees can waive the 1% Social Security Tax on their income. Employees contribute 11% of their basic salary to SSF, while employers contribute 20%. The fund provides various social security benefits including medical, accident, disability, and retirement benefits."
        }
      }, {
        "@type": "Question",
        "name": "How is the tax calculated differently for individuals versus couples in Nepal?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "For individuals, the first tax-free slab is NPR 500,000, while for couples filing jointly, it extends to NPR 600,000. This means couples can save tax on an additional NPR 100,000 of income. The subsequent tax slabs are also slightly different, with couples having NPR 900,000 in the 30% bracket compared to NPR 1,000,000 for individuals. The 36% tax bracket has been reduced from NPR 3,000,000 to NPR 2,000,000 for FY 2082-83."
        }
      }]
    }
    </script>
</body>
</html>